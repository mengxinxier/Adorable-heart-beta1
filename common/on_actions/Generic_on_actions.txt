on_actions = {
	on_offer_join_faction = {
		effect = {
			save_global_event_target_as = Adorable_heart_faction_leader
			FROM = {
				save_global_event_target_as = Adorable_heart_faction_member
			}
			set_global_flag = faction_joining_window_visible
			sound_effect = "peace_summary_message"
		}
	}
	on_state_control_changed = {
		effect = {
			### Integration Check
			FROM.FROM = {
				if = {
					limit = {
						NOT = { is_core_of = ROOT }
						impassable = no
					}
					if = {
						limit = {
							any_country_with_core = {
								has_variable = ROOT.can_integrate_@THIS
								set_temp_variable = { integration_target = THIS }
							}
						}
						if = {
							limit = {
								NOT = {
									AND = {
										has_resistance = yes
										occupied = { has_variable = ROOT.can_integrate_@THIS }
									}
								}
							}
							if = {
								limit = { has_resistance = yes }
								set_temp_variable = { previous_compliance = compliance }
								set_temp_variable = { previous_resistance = resistance }
								cancel_resistance = yes
							}
							start_resistance = var:integration_target
							set_compliance = var:previous_compliance
							set_resistance = var:previous_resistance
						}
						ROOT = {
							var:integration_target = {
								set_occupation_law_where_available = territorial_integration_95
								set_occupation_law_where_available = territorial_integration_80
								set_occupation_law_where_available = territorial_integration
							}
						}
					}
					else_if = {
						limit = { has_variable = can_integrate_@ROOT }
						start_state_integration_resistance = yes
					}
					else = {
						clear_state_integration_resistance = yes
					}
				}
				else = {
					clear_state_integration_resistance = yes
				}
			}
		}
	}
}
